---
import Parser from 'rss-parser';
import PodcastEpisode from '../../layouts/PodcastEpisode.astro';

export async function getStaticPaths() {
  // 从 RSS feed 获取所有的播客条目
  const parser = new Parser();
  const feed = await parser.parseURL('https://feed.xyzfm.space/vadx8cv4dgcb');
  console.log(feed);
  return feed.items.map((item) => ({
    params: { slug: item.guid },
	props: {
	  title: item.title,
      cover: item.itunes.image,
      pubDate: item.isoDate,
      shownotes: item.content,
      audio: item.enclosure.url,
	}
  }));
}

// 获取当前页面的 guid 参数
// const { guid } = Astro.params;
const { title, cover, pubDate, shownotes, audio } = Astro.props;

// if (!episode) {
//   throw new Error(`Episode with GUID ${guid} not found`);
// }
---

<PodcastEpisode 
  title={title} 
  cover={cover} 
  pubDate={pubDate} 
  shownotes={shownotes} 
  audio={audio} 
/>